# ‚úÖ MAX –ú–ï–°–°–ï–ù–î–ñ–ï–† –î–û–ë–ê–í–õ–ï–ù

**–î–∞—Ç–∞**: 26 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

## üá∑üá∫ –ß—Ç–æ —Ç–∞–∫–æ–µ MAX?

**MAX** - –Ω–æ–≤—ã–π —Ä–æ—Å—Å–∏–π—Å–∫–∏–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –æ—Ç –∫–æ–º–ø–∞–Ω–∏–∏ [max.ru](https://max.ru/)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- üí¨ –ë—ã—Å—Ç—Ä–æ–µ –∏ –ª—ë–≥–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—â–µ–Ω–∏—è
- üì± –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤–æ–Ω–∫–æ–≤
- üé® –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∏–∫–µ—Ä—ã –∏ —Ä–µ–∞–∫—Ü–∏–∏
- üìé –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–æ 4 –ì–ë
- ü§ñ –ß–∞—Ç-–±–æ—Ç—ã –∏ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- üåê –î–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö (iOS, Android, Web)

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. Frontend - OAuthButtons Component

**–î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ MAX:**
```tsx
<button
  onClick={handleMaxLogin}
  className="bg-gradient-to-r from-[#FF6B35] to-[#F7931E] hover:from-[#FF5722] hover:to-[#FF8A00]"
>
  <FaComment className="text-3xl" />
  <span>–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ MAX</span>
</button>
```

**–¶–≤–µ—Ç–∞:**
- –ì—Ä–∞–¥–∏–µ–Ω—Ç: `#FF6B35` ‚Üí `#F7931E` (–æ—Ä–∞–Ω–∂–µ–≤—ã–π)
- Hover: `#FF5722` ‚Üí `#FF8A00` (—è—Ä–∫–∏–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π)

**Mock –¥–∞–Ω–Ω—ã–µ:**
```typescript
const mockMaxData = {
  max_id: "123456789",           // –°–ª—É—á–∞–π–Ω—ã–π ID
  first_name: "MAX",             // –ò–º—è
  last_name: "User",             // –§–∞–º–∏–ª–∏—è
  phone: "+7900XXXXXXX"          // –¢–µ–ª–µ—Ñ–æ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
};
```

---

### 2. Backend - OAuth Endpoint

**–ù–æ–≤—ã–π endpoint:** `POST /api/oauth/max/callback`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `max_id` (required) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ MAX
- `first_name` (required) - –ò–º—è
- `last_name` (optional) - –§–∞–º–∏–ª–∏—è
- `phone` (optional) - –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ `username = "max_{max_id}"`
2. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ:
   - Email: `max_{max_id}@max.user`
   - Username: `max_{max_id}`
   - Credits: **50** (–±–æ–Ω—É—Å)
   - Tier: **FREE**
3. –°–æ–∑–¥–∞–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞
4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ httpOnly cookie
5. –í–æ–∑–≤—Ä–∞—Ç —Ç–æ–∫–µ–Ω–∞ –∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üé® –î–∏–∑–∞–π–Ω

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ (http://localhost:3002/login)

–¢–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è **3 –∫–Ω–æ–ø–∫–∏**:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üì± –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram            ‚îÇ ‚Üê –ì–æ–ª—É–±–æ–π (#0088cc)
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üîµ –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ VK                  ‚îÇ ‚Üê –°–∏–Ω–∏–π (#0077FF)
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üí¨ –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ MAX                 ‚îÇ ‚Üê –û—Ä–∞–Ω–∂–µ–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã:**
- `transform hover:scale-105` - —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
- `shadow-lg hover:shadow-xl` - —Ç–µ–Ω–∏
- `rounded-xl` - —Å–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã
- `py-4 px-6` - –±–æ–ª—å—à–∏–µ –∫–Ω–æ–ø–∫–∏

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- ‚úÖ httpOnly cookies –¥–ª—è JWT
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
- ‚úÖ –°–ª—É—á–∞–π–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ —á–µ—Ä–µ–∑ `secrets.token_urlsafe(32)`
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ username —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `max_`

### –î–ª—è Production:
```python
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π MAX OAuth 2.0
# 2. –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤ –æ—Ç MAX API
# 3. –í–∫–ª—é—á–∏—Ç—å secure=True –¥–ª—è cookies (HTTPS)
# 4. –î–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è OAuth endpoints
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Mock):

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞:**
   ```
   http://localhost:3002/login
   ```

2. **–ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ MAX"**

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
   ```sql
   SELECT id, username, email, credits_balance 
   FROM users 
   WHERE username LIKE 'max_%';
   ```

   –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
   ```
   id | username      | email                | credits_balance
   ---+---------------+----------------------+----------------
   3  | max_123456789 | max_123456789@max... | 50
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç:**
   - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ ‚Üí `/generate`
   - Toast: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —á–µ—Ä–µ–∑ MAX"

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

| –ü—Ä–æ–≤–∞–π–¥–µ—Ä | –¶–≤–µ—Ç –∫–Ω–æ–ø–∫–∏ | –ü—Ä–µ—Ñ–∏–∫—Å username | –ë–æ–Ω—É—Å | –°—Ç–∞—Ç—É—Å |
|-----------|-------------|------------------|-------|--------|
| **Telegram** | –ì–æ–ª—É–±–æ–π (#0088cc) | `tg_` | 50‚ÇΩ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **VK** | –°–∏–Ω–∏–π (#0077FF) | `vk_` | 50‚ÇΩ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| **MAX** | –û—Ä–∞–Ω–∂–µ–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç | `max_` | 50‚ÇΩ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |

---

## üöÄ Production Integration

### –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è MAX

1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ [max.ru/developers](https://max.ru/developers) (–∫–æ–≥–¥–∞ —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ)
2. –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü–æ–ª—É—á–∏—Ç—å **Client ID** –∏ **Client Secret**
4. –£–∫–∞–∑–∞—Ç—å **Redirect URI**: `https://your-domain.com/api/oauth/max/callback`

### –®–∞–≥ 2: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å OAuth 2.0 Flow

```python
# 1. Redirect –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ MAX OAuth
redirect_url = f"https://max.ru/oauth/authorize?client_id={CLIENT_ID}&redirect_uri={REDIRECT_URI}&scope=basic"

# 2. –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
code = request.query_params.get('code')

# 3. –û–±–º–µ–Ω—è—Ç—å –∫–æ–¥ –Ω–∞ —Ç–æ–∫–µ–Ω
token_response = httpx.post('https://max.ru/oauth/token', data={
    'client_id': CLIENT_ID,
    'client_secret': CLIENT_SECRET,
    'code': code,
    'redirect_uri': REDIRECT_URI
})

# 4. –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_response = httpx.get('https://max.ru/api/me', 
    headers={'Authorization': f'Bearer {access_token}'}
)
```

### –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å backend

```python
@router.get("/max/authorize")
async def max_authorize():
    """Redirect to MAX OAuth"""
    return RedirectResponse(
        url=f"https://max.ru/oauth/authorize?client_id={settings.MAX_CLIENT_ID}"
    )

@router.get("/max/callback")
async def max_callback(code: str, db: Session = Depends(get_db)):
    """Exchange code for token and create user"""
    # –†–µ–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è OAuth 2.0
    pass
```

---

## üìù –ü—Ä–∏–º–µ—Ä—ã API

### Mock –∑–∞–ø—Ä–æ—Å (—Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è):

```bash
curl -X POST http://localhost:8001/api/oauth/max/callback \
  -H "Content-Type: application/json" \
  -d '{
    "max_id": "123456789",
    "first_name": "–ò–≤–∞–Ω",
    "last_name": "–ò–≤–∞–Ω–æ–≤",
    "phone": "+79001234567"
  }'
```

### –û—Ç–≤–µ—Ç:

```json
{
  "access_token": "eyJhbGc...",
  "token_type": "bearer",
  "user": {
    "id": 3,
    "username": "max_123456789",
    "email": "max_123456789@max.user",
    "full_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "credits_balance": 50,
    "subscription_tier": "FREE",
    "is_new_user": true
  }
}
```

---

## üîó –°—Å—ã–ª–∫–∏

- **MAX –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç**: https://max.ru/
- **GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: https://github.com/vitriumd-eng/WebGen
- **Commit**: `feat: add MAX messenger OAuth support`

---

## ‚úÖ –ò—Ç–æ–≥–æ

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚úÖ –ö–Ω–æ–ø–∫–∞ MAX –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ Mock OAuth –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `max_`
- ‚úÖ 50 –±–æ–Ω—É—Å–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤
- ‚úÖ httpOnly cookies
- ‚úÖ Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
- ‚è≥ –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π MAX OAuth API (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω)
- ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–≤—è–∑–∫–∏ MAX –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É
- ‚è≥ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è —Å MAX

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ**  
**URL**: http://localhost:3002/login  
**–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É**: **Ctrl+F5**

